{"version":3,"file":"static/js/destinationSHMetro.752bb457.chunk.js","mappings":"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","sources":["svgs/destination/destination-shmetro.tsx"],"sourcesContent":["import React, { memo, useMemo, forwardRef, useRef, useState, useEffect } from 'react';\nimport { useAppSelector } from '../../redux';\n\nexport default memo(function DestinationSHMetro() {\n    return (\n        <>\n            <DefsSHMetro />\n            <InfoSHMetro />\n        </>\n    );\n});\n\nconst DefsSHMetro = memo(() => (\n    <defs>\n        {/* An extension of the line/path. Remember to minus the stroke-width.  */}\n        <marker id=\"slope\" viewBox=\"-1.5 0 3 1.5\" refY={0.5}>\n            <path d=\"M0,0L1,1H-1z\" fill=\"var(--rmg-theme-colour)\" />\n        </marker>\n    </defs>\n));\n\nconst InfoSHMetro = () => {\n    const { routes } = useAppSelector(store => store.helper);\n    const param = useAppSelector(store => store.param);\n\n    // for each left valid destinations, get the name from id\n    const validDests = [\n        ...new Set(\n            routes\n                .filter(route => route.includes(param.current_stn_idx))\n                .map(route => {\n                    let res = route.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n                    return param.direction === 'l' ? res[0] : res.reverse()[0];\n                })\n        ),\n    ];\n    const destNames: string[][] = [\n        validDests.map(id => param.stn_list[id].name[0]),\n        validDests.map(id => param.stn_list[id].name[1]),\n    ];\n\n    const terminalEl = useRef<SVGGElement | null>(null);\n    const [terminalBBox, setTerminalBBox] = useState({ width: 0 } as SVGRect);\n    useEffect(\n        () => setTerminalBBox(terminalEl.current!.getBBox()),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [...destNames.flat()]\n    );\n\n    const [middle, MARGIN, PADDING, LINEBOX_WIDTH, PLATFORM_WIDTH] = [param.svgWidth.destination / 2, 10, 36, 264, 325];\n    // Alignment Priority:\n    // 1. Centre of canvas\n    // 2. Centre of remaining\n    const platformX =\n        middle - MARGIN - PADDING - terminalBBox.width >= PLATFORM_WIDTH / 2 &&\n        middle - MARGIN - PADDING - LINEBOX_WIDTH >= PLATFORM_WIDTH / 2\n            ? middle\n            : param.direction === 'l'\n            ? (param.svgWidth.destination + terminalBBox.width - LINEBOX_WIDTH) / 2\n            : (param.svgWidth.destination - terminalBBox.width + LINEBOX_WIDTH) / 2;\n\n    // the platform screen doors flash light\n    // #20\n    // $('g#station_info_shmetro > rect').attr({ transform: `translate(${this._svgDestWidth / 2},${250 + dh})` })\n\n    return (\n        <g transform={`translate(0,${param.svg_height - 300})`}>\n            <path\n                stroke=\"var(--rmg-theme-colour)\"\n                strokeWidth={12}\n                d={\n                    param.direction === 'l'\n                        ? `M${param.svgWidth.destination - 24},16 H 36`\n                        : `M24,16 H ${param.svgWidth.destination - 36}`\n                }\n                transform=\"translate(0,220)\"\n                markerEnd=\"url(#slope)\"\n            />\n\n            <Terminal ref={terminalEl} destNames={destNames} />\n            {param.platform_num !== false && (\n                <g transform={`translate(${platformX},0)`}>\n                    <PlatformNum />\n                </g>\n            )}\n            {/* <!-- Todo: fix this absolute position --> */}\n            {/* Todo: fix svgWidth.destination*0.8, this has only been tested on 1000 width */}\n\n            {param.line_name[0].match(/^[\\w\\d]+/) ? <LineNameBoxNumber /> : <LineNameBoxText />}\n        </g>\n    );\n};\n\nconst Terminal = forwardRef((props: { destNames: string[][] }, ref: React.Ref<SVGGElement>) => {\n    const param = useAppSelector(store => store.param);\n\n    return (\n        <g ref={ref} transform={`translate(${param.direction === 'l' ? 36 : param.svgWidth.destination - 36},145)`}>\n            {useMemo(\n                () => (\n                    <>\n                        {/* translate is not a generalized implementation, only dest length of 1 and 2 are supported */}\n                        <g transform={`translate(0,${props.destNames[0].length === 2 ? -20 : 20})`}>\n                            <path\n                                d=\"M60,60L0,0L60-60H100L55-15H160V15H55L100,60z\"\n                                fill=\"black\"\n                                transform={`rotate(${param.direction === 'l' ? 0 : 180})scale(0.8)`}\n                            />\n                        </g>\n                        <g\n                            textAnchor={param.direction === 'l' ? 'start' : 'end'}\n                            transform={`translate(${param.direction === 'l' ? 128 + 20 : -128 - 20},25)`}\n                        >\n                            {props.destNames[0].map((name, i) => (\n                                <text className=\"rmg-name__zh\" fontSize={70} dy={i * -100 + 7} key={i}>\n                                    {'往' + name}\n                                </text>\n                            ))}\n                            {props.destNames[1].map((name, i) => (\n                                <text className=\"rmg-name__en\" fontSize={25} dy={i * -100 + 40} key={i}>\n                                    {'To ' + name}\n                                </text>\n                            ))}\n                        </g>\n                    </>\n                ),\n                // eslint-disable-next-line react-hooks/exhaustive-deps\n                [param.direction, ...props.destNames.flat()]\n            )}\n        </g>\n    );\n});\n\nconst PlatformNum = () => {\n    const param = useAppSelector(store => store.param);\n\n    // Total width: 325\n    return useMemo(\n        () => (\n            <g transform={`translate(${-325 / 2 + 60},150)`}>\n                <circle r={60} fill=\"none\" stroke=\"black\" strokeWidth={2} />\n                <text className=\"rmg-name__en\" dominantBaseline=\"central\" fontSize={120} textAnchor=\"middle\">\n                    {param.platform_num}\n                </text>\n                <text className=\"rmg-name__zh\" fontSize={100} dominantBaseline=\"central\" x={65}>\n                    站台\n                </text>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [param.platform_num]\n    );\n};\n\nconst LineNameBoxText = () => {\n    const { line_name, direction, svgWidth } = useAppSelector(store => store.param);\n\n    const boxX = direction === 'l' ? svgWidth.destination - 42 : 42;\n\n    // get the exact station name width so that the\n    // line color rectangle can be the right width.\n    const stnNameEl = useRef<SVGGElement | null>(null);\n    // the original name position\n    const [bBox, setBBox] = React.useState({ width: 0 } as DOMRect);\n    React.useEffect(\n        () => setBBox(stnNameEl.current!.getBBox()),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [...line_name]\n    );\n\n    const rectDx = (direction === 'l' ? -bBox.width : 0) - 6;\n    const stnNameEnDx = ((direction === 'l' ? -1 : 1) * bBox.width) / 2;\n\n    return useMemo(\n        () => (\n            <g transform={`translate(${boxX},92)`}>\n                <rect fill=\"var(--rmg-theme-colour)\" x={rectDx} width={bBox.width + 10} height={120} />\n                <g\n                    textAnchor={direction === 'r' ? 'start' : 'end'}\n                    transform=\"translate(0,68)\"\n                    fill=\"var(--rmg-theme-fg)\"\n                >\n                    <g ref={stnNameEl}>\n                        <text className=\"rmg-name__zh\" fontSize={68}>\n                            {line_name[0]}\n                        </text>\n                    </g>\n                    <text className=\"rmg-name__en\" fontSize={30} textAnchor=\"middle\" x={stnNameEnDx} dy={42}>\n                        {line_name[1]}\n                    </text>\n                </g>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [bBox, boxX, direction, line_name]\n    );\n};\n\nconst LineNameBoxNumber = () => {\n    const param = useAppSelector(store => store.param);\n\n    const [lineNumber, lineNameRes] = param.line_name[0].match(/^[\\w\\d]+|.+/g) as string[];\n\n    // Number width: 108\n    // Text width: 136\n    // Gap: 20\n    // Left: 108/2 + 20 + 136 = 210\n    // Right: 108/2 = 54\n    const boxX = param.direction === 'l' ? param.svgWidth.destination - 36 - 210 : 36 + 54;\n\n    // Total width: 264\n    return useMemo(\n        () => (\n            <g transform={`translate(${boxX},92)`}>\n                <rect fill=\"var(--rmg-theme-colour)\" x={-54} width={108} height={120} />\n                <text\n                    className=\"rmg-name__zh\"\n                    fill=\"var(--rmg-theme-fg)\"\n                    fontSize={96}\n                    textAnchor=\"middle\"\n                    dominantBaseline=\"central\"\n                    transform=\"translate(0,60)\"\n                    letterSpacing={-5}\n                >\n                    {lineNumber}\n                </text>\n                <g textAnchor=\"start\" transform=\"translate(74,68)\">\n                    <text className=\"rmg-name__zh\" fontSize={68}>\n                        {lineNameRes}\n                    </text>\n                    <text className=\"rmg-name__en\" fontSize={30} dy={42}>\n                        {param.line_name[1]}\n                    </text>\n                </g>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [boxX, ...param.line_name]\n    );\n};\n"],"names":["memo","DefsSHMetro","InfoSHMetro","id","viewBox","refY","d","fill","routes","useAppSelector","store","helper","param","validDests","Set","filter","route","includes","current_stn_idx","map","res","stnId","direction","reverse","destNames","stn_list","name","terminalEl","useRef","useState","width","terminalBBox","setTerminalBBox","useEffect","current","getBBox","flat","middle","svgWidth","destination","platformX","PLATFORM_WIDTH","transform","svg_height","stroke","strokeWidth","markerEnd","Terminal","ref","platform_num","PlatformNum","line_name","match","LineNameBoxNumber","LineNameBoxText","forwardRef","props","useMemo","length","textAnchor","i","className","fontSize","dy","r","dominantBaseline","x","boxX","stnNameEl","React","bBox","setBBox","rectDx","stnNameEnDx","height","lineNumber","lineNameRes","letterSpacing"],"sourceRoot":""}